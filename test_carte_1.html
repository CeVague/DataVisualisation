<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href="./assets/fonts/opensans.css" rel="stylesheet">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
    <script src="./lib/PapaParse-4.6.0/papaparse.js"></script> 
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
      .marker {
		background-image: url('./img/mapbox-icon.png');
		background-size: cover;
		width: 50px;
		height: 50px;
		border-radius: 50%;
		cursor: pointer;
	}
	.mapboxgl-popup {
		max-width: 200px;
	}

	.mapboxgl-popup-content {
		text-align: center;
		font-family: 'Open Sans', sans-serif;
	}



    </style>
</head>
<body>

<div id='map'></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoidGhpZWRvMTYiLCJhIjoiY2ptdzF2ejIxMGZ1ZzN3cXZpbGF4MW5hMCJ9.Tnwnv4MHIuA5bkA9swtC7Q';

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v9',
    center: [-96, 37.8],
    zoom: 3
});

Papa.parse("./data/Weather_Station_Locations.csv", {
    download: true,
    header: true,
    dynamicTyping: true,
    complete: function(results) {
        create_gson(results.data);
    },
});

function create_gson(data) {
    var i;
    var geojson = "";
    var temp;
    var l = [];
    for (i = 0; i < data.length; i++) {
        var temp = {
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: [data[i]['Longitude'], data[i]['Latitude']]
            },
            properties: {
                title: data[i]['NAME'],
                description: data[i]['WBAN']
            }
        };

        if (data[i]['Latitude'] < 90 && data[i]['Latitude'] > -90 && data[i]['Longitude'] < 90 && data[i]['Longitude'] > -90) {
            l.push(temp);
        };
    };

    console.log(l);

    l.forEach(function(marker) {

        // create a HTML element for each feature
        var el = document.createElement('div');
        el.className = 'marker';

        // make a marker for each feature and add to the map
        new mapboxgl.Marker(el)
            .setLngLat(marker.geometry.coordinates)
            .setPopup(new mapboxgl.Popup({
                    offset: 25
                }) // add popups
                .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
            .addTo(map);

    });
}


/*
var geojson = {
    type: 'FeatureCollection',
    features: [{
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: [-77.032, 38.913]
            },
            properties: {
                title: 'Mapbox',
                description: 'Washington, D.C.'
            }
        },
        {
            type: 'Feature',
            geometry: {
                type: 'Point',
                coordinates: [-122.414, 37.776]
            },
            properties: {
                title: 'Mapbox',
                description: 'San Francisco, California'
            }
        }
    ]
};

// add markers to map
geojson.features.forEach(function(marker) {

    // create a HTML element for each feature
    var el = document.createElement('div');
    el.className = 'marker';

    // make a marker for each feature and add to the map
    new mapboxgl.Marker(el)
        .setLngLat(marker.geometry.coordinates)
        .setPopup(new mapboxgl.Popup({
                offset: 25
            }) // add popups
            .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
        .addTo(map);

});
*/

</script>

</body>
</html>


