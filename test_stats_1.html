<!DOCTYPE html>
<html>
<meta charset="utf-8"/>
<head>
<script src="./lib/PapaParse-4.6.0/papaparse.js"></script>
<script src="./lib/CanvasJS/canvasjs.min.js"></script>
<script>

function group_by(data, group, get){
	var i;
	var result = {};

	for (i = 0; i < data.length; i++) {
		var key = data[i][group];
		
		if(!isNaN(-data[i][get])){
			if(key in result){
				result[key][0] += data[i][get];
				result[key][1] += 1;
			}else{
				result[key] = [ data[i][get], 1];
			};
		};
	};
	
	var final = [];
	var semaine = ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin',
	'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'];
	for(var key in result) {
		final.push({'label': semaine[key-1], 'x': key-1, 'y': (result[key][0] / result[key][1]) });
	}
	
	return final;
};



Papa.parse("./data/Summary_of_Weather.csv", {
	download: true,
	header: true,
	dynamicTyping: true,
	complete: function(results) {
		console.log("Finished:", results.data);
		console.log("Finished:", group_by(results.data, "MO", "MinTemp"));
		console.log("Finished:", group_by(results.data, "MO", "Precip"));
		
		var chart = new CanvasJS.Chart("chartContainer", {
			animationEnabled: true,
			exportEnabled: true,
			theme: "light1", // "light1", "light2", "dark1", "dark2"
			title:{
				text: "TempÃ©rature moyenne selon le mois"
			},
			data: [{
				type: "column", //change type to bar, line, area, pie, etc
				//indexLabel: "{y}", //Shows y value on all Data Points
				indexLabelFontColor: "#5A5757",
				indexLabelPlacement: "outside",
				dataPoints: group_by(results.data, "MO", "MinTemp")
			}]
		});
		chart.render();
		
		
		
		
		var chart = new CanvasJS.Chart("chartContainerBis", {
			animationEnabled: true,
			exportEnabled: true,
			theme: "light1", // "light1", "light2", "dark1", "dark2"
			title:{
				text: "Hauteur de neige moyenne par mois"
			},
			data: [{
				type: "column", //change type to bar, line, area, pie, etc
				//indexLabel: "{y}", //Shows y value on all Data Points
				indexLabelFontColor: "#5A5757",
				indexLabelPlacement: "outside",
				dataPoints: group_by(results.data, "MO", "Snowfall")
			}]
		});
		chart.render();
	},
});




Papa.parse("./data/Weather_Station_Locations.csv", {
	download: true,
	header: true,
	dynamicTyping: true,
	complete: function(results) {
		console.log("Finished:", results.data);
	},
});


</script>
</head>
<body>

<div id="chartContainer" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>

<div id="chartContainerBis" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>

</body>
</html>

